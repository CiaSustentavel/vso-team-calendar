{"version":3,"sources":["Calendar/Views.ts"],"names":["newElement","EventSourceCollection","EventSourceCollection.constructor","EventSourceCollection.getById","EventSourceCollection.getAllSources","EventSourceCollection.create","CalendarView","CalendarView.constructor","CalendarView.initialize","CalendarView._isInIteration","CalendarView._getCalendarAspectRatio","CalendarView._setupToolbar","CalendarView._createToolbarItems","CalendarView._onToolbarItemClick","CalendarView._updateTitle","CalendarView._addEventClicked","CalendarView._addDefaultEventSources","CalendarView._getCalendarEventSource","CalendarView._eventRender","CalendarView._eventAfterRender","CalendarView._dayClick","CalendarView._eventClick","CalendarView._addEvent","CalendarView._addDayOff","CalendarView._getTeamMembers","CalendarView._editEvent","CalendarView._deleteEvent","CalendarView._fetchIterationData","SummaryView","SummaryView.constructor","SummaryView.initialize","SummaryView._loadSections","SummaryView._renderSection"],"mappings":"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","file":"Calendar/Views.js","sourcesContent":["/// <reference path='../ref/VSS/VSS.d.ts' />\r\n/// <reference path='../ref/fullCalendar/fullCalendar.d.ts' />\r\n/// <reference path='../ref/moment/moment.d.ts' />\r\n\r\nimport Calendar = require(\"Calendar/Calendar\");\r\nimport Calendar_Contracts = require(\"Calendar/Contracts\");\r\nimport Calendar_Dialogs = require(\"Calendar/Dialogs\");\r\nimport Calendar_Utils_Guid = require(\"Calendar/Utils/Guid\");\r\nimport Controls = require(\"VSS/Controls\");\r\nimport Controls_Common = require(\"VSS/Controls/Common\");\r\nimport Controls_Menus = require(\"VSS/Controls/Menus\");\r\nimport Controls_Navigation = require(\"VSS/Controls/Navigation\");\r\nimport Q = require(\"q\");\r\nimport Service = require(\"VSS/Service\");\r\nimport Tfs_Core_WebApi = require(\"TFS/Core/RestClient\");\r\nimport TFS_Core_Contracts = require(\"TFS/Core/Contracts\");\r\nimport Utils_Core = require(\"VSS/Utils/Core\");\r\nimport Utils_Date = require(\"VSS/Utils/Date\");\r\nimport WebApi_Constants = require(\"VSS/WebApi/Constants\");\r\nimport WebApi_Contracts = require(\"VSS/WebApi/Contracts\");\r\nimport Work_Client = require(\"TFS/Work/RestClient\");\r\nimport Work_Contracts = require(\"TFS/Work/Contracts\");\r\n\r\nfunction newElement(tag: string, className?: string, text?: string): JQuery {\r\n    return $(\"<\" + tag + \"/>\")\r\n        .addClass(className || \"\")\r\n        .text(text || \"\");\r\n}\r\n\r\nexport class EventSourceCollection {\r\n\r\n    private static _deferred: Q.Deferred<any>;\r\n    private _collection: Calendar_Contracts.IEventSource[] = [];\r\n    private _map: { [name: string]: Calendar_Contracts.IEventSource } = {};\r\n\r\n    constructor(sources: Calendar_Contracts.IEventSource[]) {\r\n        this._collection = sources || [];\r\n        $.each(this._collection,(index: number, source: Calendar_Contracts.IEventSource) => {\r\n            this._map[source.id] = source;\r\n        });\r\n    }\r\n\r\n    public getById(id: string): Calendar_Contracts.IEventSource {\r\n        return this._map[id];\r\n    }\r\n\r\n    public getAllSources(): Calendar_Contracts.IEventSource[] {\r\n        return this._collection;\r\n    }\r\n\r\n    public static create(): IPromise<EventSourceCollection> {\r\n        if (!this._deferred) {\r\n            this._deferred = Q.defer();\r\n            VSS.getServiceContributions(VSS.getExtensionContext().namespace + \"#eventSources\").then((contributions) => {\r\n                var servicePromises = $.map(contributions, contribution => contribution.getInstance(contribution.id));\r\n                Q.allSettled(servicePromises).then((promiseStates) => {\r\n                    var services = [];\r\n                    promiseStates.forEach((promiseState, index: number) => {\r\n                        if (promiseState.value) {\r\n                            services.push(promiseState.value);\r\n                        }\r\n                        else {\r\n                            console.log(\"Failed to get calendar event source instance for: \" + contributions[index].id);\r\n                        }\r\n                    });\r\n                    this._deferred.resolve(new EventSourceCollection(services));\r\n                });\r\n            });\r\n        }\r\n\r\n        return this._deferred.promise;\r\n    }\r\n}\r\n\r\nexport interface CalendarViewOptions extends Calendar.CalendarOptions {\r\n    defaultEvents?: FullCalendar.EventObject[];\r\n}\r\n\r\nexport class CalendarView extends Controls_Navigation.NavigationView {\r\n    private _eventSources: EventSourceCollection;\r\n\r\n    private _calendar: Calendar.Calendar;\r\n    private _popupMenu: Controls_Menus.PopupMenu;\r\n    private _toolbar: Controls_Menus.MenuBar;\r\n    private _defaultEvents: FullCalendar.EventObject[];\r\n    private _calendarEventSourceMap: { [sourceId: string]: Calendar.CalendarEventSource; } = {};\r\n    private _iterations: Work_Contracts.TeamSettingsIteration[];\r\n\r\n    constructor(options: CalendarViewOptions) {\r\n        super(options);\r\n        this._eventSources = new EventSourceCollection([]);\r\n        this._defaultEvents = options.defaultEvents || [];\r\n    }\r\n\r\n    public initialize() {\r\n        \r\n        this._setupToolbar();\r\n\r\n        // Create calendar control\r\n        this._calendar = Controls.create(Calendar.Calendar, this._element.find('.calendar-container'), $.extend({}, {\r\n            fullCalendarOptions: {\r\n                aspectRatio: this._getCalendarAspectRatio(),\r\n                handleWindowResize: false // done by manually adjusting aspect ratio when the window is resized.\r\n            }\r\n        }, this._options));\r\n\r\n        EventSourceCollection.create().then((eventSources) => {\r\n\r\n            this._eventSources = eventSources;\r\n            this._calendar.addEvents(this._defaultEvents);\r\n\r\n            this._addDefaultEventSources();\r\n\r\n            this._calendar.addCallback(Calendar.FullCalendarCallbackType.eventAfterRender, this._eventAfterRender.bind(this));\r\n            this._calendar.addCallback(Calendar.FullCalendarCallbackType.dayClick, this._dayClick.bind(this));\r\n            this._calendar.addCallback(Calendar.FullCalendarCallbackType.eventClick, this._eventClick.bind(this));\r\n        });\r\n\r\n        var setAspectRatio = Utils_Core.throttledDelegate(this, 300, function () {\r\n            this._calendar.setOption(\"aspectRatio\", this._getCalendarAspectRatio());\r\n        });\r\n        window.addEventListener(\"resize\",() => {\r\n            setAspectRatio();\r\n        });\r\n\r\n        this._updateTitle();\r\n\r\n        this._fetchIterationData().then((iterations: Work_Contracts.TeamSettingsIteration[]) => {\r\n            this._iterations = iterations;\r\n        });\r\n    }\r\n\r\n    private _isInIteration(date: Date): boolean {\r\n        var inIteration: boolean = false;\r\n        this._iterations.forEach((iteration: Work_Contracts.TeamSettingsIteration, index: number, array: Work_Contracts.TeamSettingsIteration[]) => {\r\n            if (date >= iteration.attributes.startDate && date <= iteration.attributes.finishDate) {\r\n                inIteration = true;\r\n                return;\r\n            }\r\n        });\r\n        return inIteration;\r\n    }\r\n\r\n    private _getCalendarAspectRatio() {\r\n        var leftPane = this._element.closest(\".splitter>.leftPane\");\r\n        var titleBar = this._element.find(\"div.calendar-title\");\r\n        var toolbar = this._element.find(\"div.menu-container\");\r\n        return leftPane.width() / (leftPane.height() - toolbar.height() - titleBar.height() - 20);\r\n    }\r\n\r\n    private _setupToolbar () {\r\n        this._toolbar = <Controls_Menus.MenuBar>Controls.BaseControl.createIn(Controls_Menus.MenuBar, this._element.find('.menu-container'), {\r\n                            items: this._createToolbarItems(),\r\n                            executeAction: Utils_Core.delegate(this, this._onToolbarItemClick)\r\n                        });\r\n\r\n        this._element.find('.menu-container').addClass('toolbar');\r\n    }\r\n\r\n    private _createToolbarItems() : any {\r\n        return [\r\n            { id: \"new-item\", text: \"New Item\", title: \"Add event\", icon: \"icon-add-small\", showText: false},\r\n            { separator: true },\r\n            { id: \"refresh-items\", title: \"Refresh\", icon: \"icon-refresh\", showText: false },\r\n            { id: \"move-today\", text: \"Today\", title: \"Today\", noIcon: true, showText: true, cssClass: \"right-align\"},\r\n            { id: \"move-next\", text: \"Next\", icon: \"icon-drop-right\", title: \"Next\", noIcon: false, showText: false, cssClass: \"right-align\"},\r\n            { id: \"move-prev\", text: \"Prev\", icon: \"icon-drop-left\", showText: false , title: \"Previous\", noIcon: false, cssClass: \"right-align\"}\r\n        ];\r\n    }\r\n\r\n    public _onToolbarItemClick(e?: any): any {\r\n        var command = e ? e.get_commandName() : '';\r\n        var result = false;\r\n        switch (command) {\r\n            case \"refresh-items\":\r\n                this._calendar.refreshEvents();\r\n                break;\r\n            case \"new-item\":\r\n                this._addEventClicked();\r\n                break;\r\n            case \"move-prev\":\r\n                this._calendar.prev();\r\n                this._updateTitle();\r\n                break;\r\n            case \"move-next\":\r\n                this._calendar.next();\r\n                this._updateTitle();\r\n                break;\r\n            case \"move-today\":\r\n                this._calendar.showToday();\r\n                this._updateTitle();\r\n                break;\r\n            default:\r\n                result = true;\r\n                break;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private _updateTitle() : void {\r\n        var formattedDate = this._calendar.getFormattedDate('MMMM YYYY');\r\n        $('.calendar-title').text(formattedDate);\r\n    }\r\n\r\n    private _addEventClicked() : void {\r\n        // Find the free form event source\r\n        var addEventSources: Calendar_Contracts.IEventSource[] = $.grep(this._eventSources.getAllSources(),(eventSource) => { return !!eventSource.addEvents; });\r\n\r\n        // Setup the event\r\n        var event: Calendar_Contracts.CalendarEvent = {\r\n            title: \"\",\r\n            startDate: Utils_Date.shiftToUTC(new Date()),\r\n            eventId: Calendar_Utils_Guid.newGuid()\r\n        };\r\n\r\n        this._addEvent(event, addEventSources[0])\t\t\r\n    }\r\n\r\n    private _addDefaultEventSources(): void {\r\n\r\n        var eventSources = $.map(this._eventSources.getAllSources(),(eventSource) => {\r\n            var sourceAndOptions = <Calendar.SourceAndOptions>{\r\n                source: eventSource,\r\n                callbacks: {}\r\n            };\r\n            sourceAndOptions.callbacks[Calendar.FullCalendarCallbackType.eventRender] = this._eventRender.bind(this, eventSource);\r\n            if (eventSource.background) {\r\n                sourceAndOptions.options = { rendering: \"background\" };\r\n            }\r\n            return sourceAndOptions;\r\n        });\r\n\r\n        var calendarEventSources = this._calendar.addEventSources(eventSources);\r\n        calendarEventSources.forEach((calendarEventSource, index) => {\r\n            this._calendarEventSourceMap[eventSources[index].source.id] = calendarEventSource;\r\n        });\r\n    }\r\n\r\n    private _getCalendarEventSource(eventSourceId: string): Calendar.CalendarEventSource {\r\n        return this._calendarEventSourceMap[eventSourceId];\r\n    }\r\n\r\n    private _eventRender(eventSource: Calendar_Contracts.IEventSource, event: FullCalendar.EventObject, element: JQuery, view: FullCalendar.View) {\r\n\r\n        if (event.rendering !== 'background') {\r\n            var commands = [];\r\n\r\n            if (eventSource.updateEvents) {\r\n                commands.push({ rank: 5, id: \"Edit\", text: \"Edit\", icon: \"icon-edit\" });\r\n            }\r\n            if (eventSource.removeEvents) {\r\n                commands.push({ rank: 10, id: \"Delete\", text: \"Delete\", icon: \"icon-delete\" });\r\n            }\r\n\r\n            if (commands.length > 0) {\r\n                var menuOptions = {\r\n                    items: commands,\r\n                    executeAction: (e) => {\r\n                        var command = e.get_commandName();\r\n\r\n                        switch (command) {\r\n                            case \"Edit\":\r\n                                this._editEvent(<Calendar_Contracts.IExtendedCalendarEventObject> event);\r\n                                break;\r\n                            case \"Delete\":\r\n                                this._deleteEvent(<Calendar_Contracts.IExtendedCalendarEventObject> event);\r\n                                break;\r\n                        }\r\n                    }\r\n                };\r\n\r\n                var $element = $(element);\r\n                $element.on(\"contextmenu\",(e: JQueryEventObject) => {\r\n                    if (this._popupMenu) {\r\n                        this._popupMenu.dispose();\r\n                        this._popupMenu = null;\r\n                    }\r\n                    this._popupMenu = <Controls_Menus.PopupMenu>Controls.BaseControl.createIn(Controls_Menus.PopupMenu, this._element, $.extend(\r\n                        {\r\n                            align: \"left-bottom\"\r\n                        },\r\n                        menuOptions,\r\n                        {\r\n                            items: [{ childItems: Controls_Menus.sortMenuItems(commands) }]\r\n                        }));\r\n                    Utils_Core.delay(this, 10, function () {\r\n                        this._popupMenu.popup(this._element, $element);\r\n                    });\r\n                    e.preventDefault();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private _eventAfterRender(event: FullCalendar.EventObject, element: JQuery, view: FullCalendar.View) {\r\n        if (event.rendering === \"background\") {\r\n            element.addClass(\"sprint-event\");\r\n            element.data(\"event\", event);\r\n            var contentCellIndex = 0;\r\n            var $contentCells = element.closest(\".fc-row.fc-widget-content\").find(\".fc-content-skeleton table tr td\");\r\n            element.parent().children().each((index: number, child: Element) => {\r\n                if ($(child).data(\"event\") && $(child).data(\"event\").title === event.title) {\r\n                    return false; // break;\r\n                }\r\n                contentCellIndex += parseInt($(child).attr(\"colspan\"));\r\n            });\r\n            if (event[\"sprintProcessedFor\"] === undefined || event[\"sprintProcessedFor\"] !== view[\"renderId\"]) {\r\n                event[\"sprintProcessedFor\"] = view[\"renderId\"];\r\n                $contentCells.eq(contentCellIndex).append($(\"<span/>\").addClass(\"sprint-label\").text(event.title));\r\n            }\r\n        }\r\n    }\r\n\r\n    private _dayClick(date: Date, jsEvent: MouseEvent, view: FullCalendar.View) {\r\n        //This should not be hard-coded, we should instead figure out context menu commands\r\n        //and dialog contents dynamically from the source\r\n        var addEventSources: Calendar_Contracts.IEventSource[];\r\n        addEventSources = $.grep(this._eventSources.getAllSources(),(eventSource) => { return !!eventSource.addEvents; });\r\n\r\n        if (addEventSources.length > 0) {\r\n            var event: Calendar_Contracts.CalendarEvent = {\r\n                title: \"\",\r\n                startDate: Utils_Date.shiftToUTC(new Date(date.valueOf())),\r\n                eventId: Calendar_Utils_Guid.newGuid()\r\n            };\r\n\r\n\r\n            var commands = [];\r\n\r\n            commands.push({ rank: 5, id: \"addEvent\", text: \"Add event\", icon: \"icon-add\" });\r\n            commands.push({ rank: 10, id: \"addDayOff\", text: \"Add day off\", icon: \"icon-tfs-build-reason-schedule\", disabled: !this._isInIteration(date) });\r\n            var menuOptions = {\r\n                items: commands,\r\n                executeAction: (e) => {\r\n                    var command = e.get_commandName();\r\n\r\n                    switch (command) {\r\n                        case \"addEvent\":\r\n                            this._addEvent(event, addEventSources[0]);\r\n                            break;\r\n                        case \"addDayOff\":\r\n                            this._addDayOff(event, addEventSources[1]);\r\n                            break;\r\n                    }\r\n                }\r\n            };\r\n\r\n            var dataDate = Utils_Date.format(Utils_Date.shiftToUTC(new Date(date.valueOf())), \"yyyy-MM-dd\"); //2015-04-19\r\n            var $element = $(\"td.fc-day-number[data-date='\" + dataDate + \"']\");\r\n            if (this._popupMenu) {\r\n                this._popupMenu.dispose();\r\n                this._popupMenu = null;\r\n            }\r\n            this._popupMenu = <Controls_Menus.PopupMenu>Controls.BaseControl.createIn(Controls_Menus.PopupMenu, this._element, $.extend(\r\n                menuOptions,\r\n                {\r\n                    align: \"left-bottom\",\r\n                    items: [{ childItems: Controls_Menus.sortMenuItems(commands) }]\r\n\r\n                }));\r\n            Utils_Core.delay(this, 10, function () {\r\n                this._popupMenu.popup(this._element, $element);\r\n            });\r\n        }\r\n    }\r\n\r\n    private _eventClick(event: FullCalendar.EventObject, jsEvent: MouseEvent, view: FullCalendar.View) {\r\n        this._editEvent(<Calendar_Contracts.IExtendedCalendarEventObject> event);\r\n    }\r\n\r\n    private _addEvent(event: Calendar_Contracts.CalendarEvent, eventSource: Calendar_Contracts.IEventSource) {\r\n        var query = this._calendar.getViewQuery();\r\n        Controls_Common.Dialog.show(Calendar_Dialogs.EditFreeFormEventDialog, {\r\n            event: event,\r\n            title: \"Add Event\",\r\n            resizable: false,\r\n            okCallback: (calendarEvent: Calendar_Contracts.CalendarEvent) => {\r\n                eventSource.addEvents([calendarEvent]).then((calendarEvents: Calendar_Contracts.CalendarEvent[]) => {\r\n                    var calendarEventSource = this._getCalendarEventSource(eventSource.id);\r\n                    calendarEventSource.state.dirty = true;\r\n                    this._calendar.renderEvent(calendarEvent, eventSource.id);\r\n                });\r\n            },\r\n            categories: this._eventSources.getById(\"freeForm\").getCategories(query).then(categories => categories.map(category => category.title))\r\n        });\r\n    }\r\n\r\n    private _addDayOff(event: Calendar_Contracts.CalendarEvent, eventSource: Calendar_Contracts.IEventSource) {\r\n        var webContext: WebContext = VSS.getWebContext();\r\n        event.member = { displayName: webContext.user.name, id: webContext.user.id, imageUrl: \"\", uniqueName: \"\", url: \"\" };\r\n        Controls_Common.Dialog.show(Calendar_Dialogs.EditCapacityEventDialog, {\r\n            event: event,\r\n            title: \"Add Days Off\",\r\n            resizable: false,\r\n            okCallback: (calendarEvent: Calendar_Contracts.CalendarEvent) => {\r\n                eventSource.addEvents([calendarEvent]).then((calendarEvents: Calendar_Contracts.CalendarEvent[]) => {\r\n                    var calendarEventSource = this._getCalendarEventSource(eventSource.id);\r\n                    calendarEventSource.state.dirty = true;\r\n                    calendarEvent.category = \"DaysOff\";\r\n                    this._calendar.renderEvent(calendarEvent, eventSource.id);\r\n                });\r\n            },\r\n            membersPromise: this._getTeamMembers()\r\n        });\r\n    }\r\n\r\n    private _getTeamMembers(): IPromise<WebApi_Contracts.IdentityRef[]> {\r\n        var deferred = Q.defer<WebApi_Contracts.IdentityRef[]>();\r\n\r\n        var webContext = VSS.getWebContext();\r\n        var workClient: Tfs_Core_WebApi.CoreHttpClient = Service.VssConnection\r\n            .getConnection()\r\n            .getHttpClient(Tfs_Core_WebApi.CoreHttpClient, WebApi_Constants.ServiceInstanceTypes.TFS);\r\n\r\n        // fetch the wit events\r\n        workClient.getTeamMembers(webContext.project.name, webContext.team.name).then((members: WebApi_Contracts.IdentityRef[]) => {\r\n            deferred.resolve(members);\r\n        });\r\n\r\n        return deferred.promise;\r\n    }\r\n\r\n\r\n    private _editEvent(event: Calendar_Contracts.IExtendedCalendarEventObject): void {\r\n        var calendarEvent: Calendar_Contracts.CalendarEvent = {\r\n            startDate: Utils_Date.addDays(new Date((<Date>event.start).valueOf()), 1),\r\n            endDate: <Date>event.end,\r\n            title: event.title,\r\n            eventId: event.id,\r\n            category: event.category,\r\n            member: event.member\r\n        };\r\n        var calendarEventSource: Calendar_Contracts.IEventSource;\r\n        var eventSource;\r\n        if(event.source) {\r\n            calendarEventSource = <Calendar_Contracts.IEventSource>event.source.events;\r\n            if(calendarEventSource){\r\n                eventSource = (<any>calendarEventSource).eventSource;\r\n            }\r\n        } else if(event.eventType){\r\n            eventSource = this._eventSources.getById(event.eventType);\r\n        }\r\n\r\n        if (eventSource && eventSource.updateEvents) {\r\n            if (eventSource.id === \"freeForm\") {\r\n                var query = this._calendar.getViewQuery();\r\n                Controls_Common.Dialog.show(Calendar_Dialogs.EditFreeFormEventDialog, {\r\n                    event: calendarEvent,\r\n                    title: \"Edit Event\",\r\n                    resizable: false,\r\n                    okCallback: (calendarEvent: Calendar_Contracts.CalendarEvent) => {\r\n                        eventSource.updateEvents([calendarEvent]).then((calendarEvents: Calendar_Contracts.CalendarEvent[]) => {\r\n                            // Set underlying source to dirty so refresh picks up new changes\r\n                            var originalEventSource = this._getCalendarEventSource(eventSource.id);\r\n                            originalEventSource.state.dirty = true;\r\n\r\n                            // Update title\r\n                            event.title = calendarEvent.title;\r\n\r\n                            // Update category\r\n                            event.category = calendarEvent.category;\r\n\r\n                            //Update dates\r\n                            var end = Utils_Date.addDays(new Date(calendarEvent.endDate.valueOf()), 1);\r\n                            event.end = end;\r\n                            event.start = calendarEvent.startDate;\r\n                            this._calendar.updateEvent(event);\r\n                        });\r\n                    },\r\n                    categories: this._eventSources.getById(\"freeForm\").getCategories(query).then(categories => categories.map(category => category.title))\r\n                });\r\n            }\r\n            else if (eventSource.id === \"daysOff\") {\r\n                Controls_Common.Dialog.show(Calendar_Dialogs.EditCapacityEventDialog, {\r\n                    event: calendarEvent,\r\n                    title: \"Edit Days Off\",\r\n                    resizable: false,\r\n                    isEdit: true,\r\n                    okCallback: (calendarEvent: Calendar_Contracts.CalendarEvent) => {\r\n                        eventSource.updateEvents([calendarEvent]).then((calendarEvents: Calendar_Contracts.CalendarEvent[]) => {\r\n                            // Set underlying source to dirty so refresh picks up new changes\r\n                            var originalEventSource = this._getCalendarEventSource(eventSource.id);\r\n                            originalEventSource.state.dirty = true;\r\n\r\n\r\n                            //Update dates\r\n                            var end = Utils_Date.addDays(new Date(calendarEvent.endDate.valueOf()), 1);\r\n                            event.end = end;\r\n                            event.start = calendarEvent.startDate;\r\n\r\n                            this._calendar.updateEvent(event);\r\n                        });\r\n                    },\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private _deleteEvent(event: Calendar_Contracts.IExtendedCalendarEventObject): void {\r\n        var start = new Date((<Date>event.start).valueOf());\r\n        var calendarEvent: Calendar_Contracts.CalendarEvent = {\r\n            startDate: start,\r\n            title: event.title,\r\n            eventId: event.id,\r\n            category: event.category,\r\n            member: event.member\r\n        };\r\n\r\n        var calendarEventSource: Calendar_Contracts.IEventSource;\r\n        var eventSource;\r\n        if (event.source) {\r\n            calendarEventSource = <Calendar_Contracts.IEventSource>event.source.events;\r\n            if (calendarEventSource) {\r\n                eventSource = (<any>calendarEventSource).eventSource;\r\n            }\r\n        } else if (event.eventType) {\r\n            eventSource = this._eventSources.getById(event.eventType);\r\n        }\r\n\r\n        if (eventSource && eventSource.removeEvents) {\r\n            if (confirm(\"Are you sure you want to delete the event?\")) {\r\n                eventSource.removeEvents([calendarEvent]).then((calendarEvents: Calendar_Contracts.CalendarEvent[]) => {\r\n                    var originalEventSource = this._getCalendarEventSource(eventSource.id);\r\n                    originalEventSource.state.dirty = true;\r\n                    this._calendar.removeEvent(<string>event.id);\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private _fetchIterationData(): IPromise<Work_Contracts.TeamSettingsIteration[]> {\r\n        var deferred = Q.defer<Work_Contracts.TeamSettingsIteration[]>();\r\n        var iterationPath: string;\r\n        var iterationPromises: IPromise<Work_Contracts.TeamSettingsIteration>[] = [];\r\n        var result : Work_Contracts.TeamSettingsIteration[] = [];\r\n\r\n        var webContext = VSS.getWebContext();\r\n        var teamContext: TFS_Core_Contracts.TeamContext = { projectId: webContext.project.id, teamId: webContext.team.id, project: \"\", team: \"\" };\r\n        var workClient: Work_Client.WorkHttpClient = Service.VssConnection\r\n            .getConnection()\r\n            .getHttpClient(Work_Client.WorkHttpClient, WebApi_Constants.ServiceInstanceTypes.TFS);\r\n\r\n        workClient.getTeamIterations(teamContext).then(\r\n            (iterations: Work_Contracts.TeamSettingsIteration[]) => {\r\n                iterations.forEach((iteration: Work_Contracts.TeamSettingsIteration, index: number, array: Work_Contracts.TeamSettingsIteration[]) => {\r\n                    result.push(iteration);\r\n                });\r\n\r\n\r\n                deferred.resolve(result);\r\n\r\n            },\r\n            (e: Error) => {\r\n                deferred.reject(e);\r\n            });\r\n        return deferred.promise;\r\n    }\r\n}\r\n\r\nexport class SummaryView extends Controls.BaseControl {\r\n    private _calendar: Calendar.Calendar;\r\n    private _rendering: boolean;\r\n\r\n    initialize(): void {\r\n        super.initialize();\r\n        this._rendering = false;\r\n        this._calendar = <Calendar.Calendar>Controls.Enhancement.getInstance(Calendar.Calendar, $(\".vss-calendar\"));\r\n\r\n        // Attach to calendar changes to refresh summary view\r\n        this._calendar.addCallback(Calendar.FullCalendarCallbackType.eventAfterAllRender,() => {\r\n            EventSourceCollection.create().then((eventSources: EventSourceCollection) => {\r\n                if (!this._rendering) {\r\n                    this._rendering = true;\r\n                    this._loadSections(eventSources);\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    private _loadSections(eventSources: EventSourceCollection): void {\r\n        // Clear DOM elements first\r\n        this.getElement().children().remove();\r\n\r\n        // Sort event sources\r\n        var sources = eventSources.getAllSources().slice(0).sort(\r\n            (es1: Calendar_Contracts.IEventSource, es2: Calendar_Contracts.IEventSource) => {\r\n                return es1.order - es2.order;\r\n            });\r\n\r\n        var categoryPromises = [];\r\n        // Render each section\r\n        $.each(sources,(index: number, source: Calendar_Contracts.IEventSource) => {\r\n            categoryPromises.push(this._renderSection(source));\r\n        });\r\n\r\n        Q.all(categoryPromises).then(() => {\r\n            this._rendering = false;\r\n        });\r\n    }\r\n\r\n    private _renderSection(source: Calendar_Contracts.IEventSource): IPromise<Calendar_Contracts.IEventSource> {\r\n        var deferred = Q.defer<Calendar_Contracts.IEventSource>();\r\n        // Form query using the current date of the calendar\r\n        var query = this._calendar.getViewQuery();\r\n        // Get events categorized\r\n        source.getCategories(query).then(\r\n            (categories: Calendar_Contracts.IEventCategory[]) => {\r\n                if (categories.length > 0) {\r\n                    var $sectionContainer = newElement(\"div\", \"category\").appendTo(this.getElement());\r\n                    newElement(\"h3\", \"\", source.name).appendTo($sectionContainer);\r\n                    $.each(categories,(index: number, category: Calendar_Contracts.IEventCategory) => {\r\n                        var $titleContainer = newElement(\"div\", \"category-title\").appendTo($sectionContainer);\r\n                        if (category.imageUrl) {\r\n                            newElement(\"img\", \"category-icon\").attr(\"src\", category.imageUrl).appendTo($titleContainer);\r\n                        }\r\n                        if (category.color) {\r\n                            newElement(\"div\", \"category-color\").css(\"background-color\", category.color).appendTo($titleContainer);\r\n                        }\r\n                        newElement(\"span\", \"category-titletext\", category.title).appendTo($titleContainer);\r\n                        newElement(\"div\", [\"category-subtitle\", (category.color ? \"c-color\" : \"\"), (category.imageUrl ? \"c-icon\" : \"\")].join(\" \"), category.subTitle).appendTo($sectionContainer);\r\n                    });\r\n                }\r\n                deferred.resolve(source);\r\n            });\r\n        return deferred.promise;\r\n    }\r\n}\r\n\r\n"],"sourceRoot":"/source/"}